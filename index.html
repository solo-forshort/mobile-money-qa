<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Money Security Q&A</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: #f4f4f9;
        padding: 20px;
    }
    h1 {
        text-align: center;
        color: #333;
    }
    .controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .ask-question-btn {
        background: #27ae60;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        text-decoration: none;
        font-weight: bold;
        transition: background 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    .ask-question-btn:hover {
        background: #219a52;
    }
    input, select {
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
    }
    .card {
        background: white;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        min-height: 120px;
        max-height: 180px;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .priority {
        font-weight: bold;
        padding: 4px 8px;
        border-radius: 6px;
        display: inline-block;
        color: white;
        margin-bottom: 5px;
    }
    .priority.High { background: #e74c3c; }
    .priority.Medium { background: #f39c12; }
    .priority.Low { background: #2ecc71; }
    .tag {
        background: #3498db;
        color: white;
        padding: 3px 8px;
        border-radius: 10px;
        font-size: 0.85em;
        display: inline-block;
        margin-bottom: 10px;
    }
    .question {
        font-size: 0.95em;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
        line-height: 1.3;
    }
    .notes {
        font-size: 0.8em;
        color: #555;
        line-height: 1.3;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }
    .loading {
        text-align: center;
        color: #666;
        font-style: italic;
        margin-top: 50px;
    }
    .debug {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 10px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 0.8em;
    }
</style>
</head>
<body>

<h1>Mobile Money Security Q&A</h1>

<div class="controls">
    <input type="text" id="search" placeholder="Search questions...">
    <select id="priorityFilter">
        <option value="">All Priorities</option>
        <option value="High">High</option>
        <option value="Medium">Medium</option>
        <option value="Low">Low</option>
    </select>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSc4S6LV8NWwomzoGudHhDoAdwbQUblw3jOjVmvk4l6275Voeg/viewform?usp=sharing&ouid=117936331264839609159" target="_blank" class="ask-question-btn">
        Ask a Question
    </a>
</div>

<div id="debug" class="debug" style="display:none;"></div>

<div class="grid" id="cardContainer">
    <div class="loading">Loading questions from Google Sheets...</div>
</div>

<script>
    const sheetURL = "https://opensheet.elk.sh/12bqzmih2nvVQnSYAMggXG3FBrbZyXhC5IaAEhqydkb0/1";
    let allData = [];
    
    // Debug function
    function debug(message, data = null) {
        const debugDiv = document.getElementById("debug");
        debugDiv.style.display = "block";
        debugDiv.innerHTML += `<div>${message}</div>`;
        if (data) {
            debugDiv.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
    }

    // Sample data for preview
    const sampleData = [
        {
            Question: "How can I know a transaction is fake?",
            Priority: "High",
            Tag: "Mobile Money Fraud",
            Notes: "Key Point: Vendors should never share their mobile money PIN"
        },
        {
            Question: "What should I do if I lose my SIM card?",
            Priority: "High",
            Tag: "SIM Security",
            Notes: "Immediately contact your network provider to block the SIM"
        }
    ];

    // Fetch data from Google Sheets
    debug("Fetching data from: " + sheetURL);
    
    fetch(sheetURL)
        .then(res => {
            debug("API Response Status: " + res.status);
            return res.json();
        })
        .then(data => {
            debug("Raw data received:", data);
            
            // Process the data
            allData = data.map((row, index) => {
                debug(`Processing row ${index}:`, row);
                
                const question = row["Question 1\nWhat common mobile money security question or concern do you have? \n      Example: \"What do I do if I lose my SIM card?\" or\n                        \"How can I know a transaction is fake?\""] || "";
                const priority = row["Priority (H/M/L) "] || "";
                const tag = row["Tag (e.g., SIM swap, phishing, PIN safety)."] || row["Question 2\nWhich category does your question fit best?  "] || "";
                const notes = row["Notes â†’ any extra remarks"] || row["Question 3\nPlease describe a real situation or example of your concern (if you have one).  "] || "";
                const timestamp = row["Timestamp"] || "";
                
                return {
                    Question: question.trim(),
                    Priority: priority === "H" ? "High" : priority === "M" ? "Medium" : priority === "L" ? "Low" : priority || "Medium",
                    Tag: tag.trim() || "Mobile Money",
                    Notes: notes.trim() || "No additional notes",
                    Timestamp: timestamp,
                    OriginalRow: index
                };
            }).filter(row => {
                const hasQuestion = row.Question && row.Question.length > 0;
                debug(`Row ${row.OriginalRow} - Has question: ${hasQuestion} - Question: "${row.Question}"`);
                return hasQuestion;
            });
            
            debug("Filtered data:", allData);
            
            if (allData.length === 0) {
                debug("No valid data found, using sample data");
                allData = sampleData;
            }
            
            renderCards(allData);
        })
        .catch(error => {
            debug("Error fetching data:", error);
            allData = sampleData;
            renderCards(allData);
        });

    function renderCards(data) {
        debug(`Rendering ${data.length} cards`);
        const container = document.getElementById("cardContainer");
        container.innerHTML = "";

        data.forEach((row, index) => {
            debug(`Creating card ${index} for: "${row.Question}"`);
            
            const card = document.createElement("div");
            card.className = "card";

            const priority = document.createElement("div");
            priority.className = `priority ${row.Priority}`;
            priority.textContent = row.Priority || "Unknown";

            const tag = document.createElement("div");
            tag.className = "tag";
            tag.textContent = row.Tag || "General";

            const question = document.createElement("div");
            question.className = "question";
            question.textContent = row.Question;

            const notes = document.createElement("div");
            notes.className = "notes";
            notes.textContent = row.Notes || "No additional notes";

            card.appendChild(priority);
            card.appendChild(tag);
            card.appendChild(question);
            card.appendChild(notes);

            container.appendChild(card);
        });
    }

    document.getElementById("search").addEventListener("input", function () {
        const term = this.value.toLowerCase();
        const filtered = allData.filter(row =>
            row.Question.toLowerCase().includes(term)
        );
        renderCards(filtered);
    });

    document.getElementById("priorityFilter").addEventListener("change", function () {
        const selected = this.value;
        const filtered = selected
            ? allData.filter(row => row.Priority === selected)
            : allData;
        renderCards(filtered);
    });
</script>

</body>
</html>
